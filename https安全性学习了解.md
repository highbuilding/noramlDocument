# https安全性
## https的概念
>>HTTPS是身披SSL外壳的HTTP。HTTPS是一种通过计算机网络进行安全通信的传输协议，经由HTTP进行通信，利用SSL/TLS建立全信道，加密数据包。HTTPS使用的主要目的是提供对网站服务器的身份认证，同时保护交换数据的隐私与完整性。TLS是传输层加密协议，前身是SSL协议，由网景公司1995年发布，有时候两者不区分。

## 加密基本概念
### 加密方式
* 共享秘钥加密(对称秘钥加密)
>> 加密和解密同用一个密钥。加密时就必须将密钥传送给对方，那么如何安全的传输呢？
* 公开密钥加密（非对称密钥加密）
>> 公开密钥加密使用一对非对称的密钥。一把叫做私有密钥，一把叫做公开密钥。私有密钥不能让其他任何人知道，而公开密钥则可以随意发布，任何人都可以获得。使用此加密方式，发送密文的一方使用公开密钥进行加密处理，对方收到被加密的信息后，再使用自己的私有密钥进行解密。利用这种方式，不需要发送用来解密的私有密钥，也不必担心密钥被攻击者窃听盗走。
* HTTPS采用的加密方式
>>在交换密钥阶段使用公开密钥加密方式，之后建立通信交换报文阶段则使用共享密钥加密方式。
### 名词解释
1. 密钥对
>>在非对称加密技术中，有两种密钥，分为私钥和公钥，私钥是密钥对所有者持有，不可公布，公钥是密钥对持有者公布给他人的。
2. 公钥
>>公钥用来给数据加密，用公钥加密的数据只能使用私钥解密。
3. 摘要
>>对需要传输的文本，做一个HASH计算，一般采用SHA1，SHA2来获得。
4. 签名
>> 使用私钥对需要传输的文本的摘要进行加密，得到的密文即被称为该次传输过程的签名。
5. 签名验证
>> 数据接收端，拿到传输文本，但是需要确认该文本是否就是发送发出的内容，中途是否曾经被篡改。因此拿自己持有的公钥对签名进行解密（密钥对中的 一种密钥加密的数据必定能使用另一种密钥解密。），得到了文本的摘要，然后使用与发送方同样的HASH算法计算摘要值，再与解密得到的摘要做对比，发现二 者完全一致，则说明文本没有被篡改过。
6. CA
>>签名的过程中，有一点很关键，收到数据的一方，需要自己保管好公钥，可要知道每一个发送方都有一个公钥，那么接收数据的人需要保存非常多的公钥，这根本 就管理不过来。并且本地保存的公钥有可能被篡改替换，无从发现。怎么解决这一问题了？由一个统一的证书管理机构来管理所有需要发送数据方的公钥，对公钥进 行认证和加密。这个机构也就是我们常说的CA。
7. CA证书
>> 认证加密后的公钥，即是证书，又称为CA证书，证书中包含了很多信息，最重要的是申请者的公钥。
8. CA根证书
>>CA机构在给申请者的公钥加密时，用的也是一组“统一密钥对”。在加密公钥时，用其中的私钥。这样，申请者拿到证书后，在发送数据时，用申请者自己的私钥生成签名，将签名、 证书和发送内容一起发给对方。接受者拿到了证书后，需要对证书本身解密从而获取到证书中申请者的公钥，解密需要用到CA机构的“统一密钥对”中的公钥，这个公钥也就是我们常说的CA根证书。
## https安全通信的保障机制
1. 认证服务器
>> 浏览器内置一个受信任的CA机构列表，并保存了这些CA机构的证书。第一阶段服务器会提供经CA机构认证颁发的服务器证书，如果认证该服务器证书的CA机构，存在于浏览器的受信任CA机构列表中，并且服务器证书中的信息与当前正在访问的网站（域名等）一致，那么浏览器就认为服务端是可信的，并从服务器证书中取得服务器公钥，用于后续流程。否则，浏览器将提示用户，根据用户的选择，决定是否继续。当然，我们可以管理这个受信任CA机构列表，添加我们想要信任的CA机构，或者移除我们不信任的CA机构。
2. 协商会话密钥
>> 客户端在认证完服务器，获得服务器的公钥之后，利用该公钥与服务器进行加密通信，协商出两个会话密钥，分别是用于加密客户端往服务端发送数据的客户端会话密钥，用于加密服务端往客户端发送数据的服务端会话密钥。在已有服务器公钥，可以加密通讯的前提下，还要协商两个对称密钥的原因，是因为非对称加密相对复杂度更高，在数据传输过程中，使用对称加密，可以节省计算资源。另外，会话密钥是随机生成，每次协商都会有不一样的结果，所以安全性也比较高。
## HTTPS的通信步骤
1. 客户端通过发送Client **Hello报文**开始SSL通信（这里是在TCP的三次握手已经完成的基础上进行的）。报文中包含客户端支持的SSL的指定版本、加密组件列表（所使用的加密算法及密钥长度等）。

2. 服务器可进行SSL通信时，会以Server **Hello报文**作为应答。和客户端一样，在报文中包含SSL版本以及加密组件。服务器的加密组件内容是从接收到的客户端加密组件内筛选出来的。

3. 之后服务器发送**Certificate报文**。报文中包含公开密钥证书。

4. 最后服务器发送Server **Hello Done报文通**知客户端，最初阶段的SSL握手协商部分结束。

5. SSL第一次握手结束之后，客户端以**Client Key Exchange报文**作为回应。报文中包含通信加密中使用的一种被称为**Pre-master secret**的随机密码串。该报文已用步骤3中的公开密钥进行加密。

6. 接着客户端继续发送**Change Cipher Spec报文**。该报文会提示服务器，在此报文之后的通信会采用**Pre-master secret**密钥加密。

7. 客户端发送**Finished报文**。该报文包含连接至今全部报文的整体校验值。这次握手协商是否能够成功，要以服务器是否能够正确解密该报文作为判定标准。

8. 服务器同样发送**Change Cipher Spec报文**。

9. 服务器同样发送**Finshed报文**。

10. 服务器和客户端的**Finished报文**交换完毕之后，SSL连接就算建立完成。当然，通信会受到SSL的保护。从此处开始进行应用层协议的通信，即发送HTTP请求。

11. 应用层协议通信，即发送HTTP响应。

12. 最后由客户端断开连接。断开连接时，发送**close_notify报文**。上图做客一些省略，这步之后再发送**TCP FIN报文**来关闭与TCP的通信。





